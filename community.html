<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Coach - Entrepreneur Emotional Health</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* RESPONSIVE AI COACH LAYOUT */
        
        /* Base layout - full width */
        .main-content {
            width: 100% !important;
            max-width: 100% !important;
            margin-left: 0 !important;
            padding: 2rem !important;
        }
        
        .content-header {
            margin-bottom: 2rem;
        }
        
        /* AI Coach Container - Full Screen Layout */
        .ai-coach-container {
            display: flex;
            height: calc(100vh - 10rem);
            background: var(--background);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            overflow: hidden;
            width: 100%;
            max-width: 100%;
        }
        
        /* Chat Container - Takes Most Space */
        .chat-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 0;
            background: var(--background);
            overflow: hidden;
        }
        
        /* Chat Header */
        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--surface);
            flex-shrink: 0;
        }
        
        .coach-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .coach-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .coach-details h2 {
            margin-bottom: 0.25rem;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.25rem;
        }
        
        .coach-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        
        /* Messages Area */
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            background: var(--surface);
            -webkit-overflow-scrolling: touch;
        }
        
        .message {
            display: flex;
            gap: 1rem;
            max-width: 85%;
            animation: messageSlide 0.3s ease-out;
        }
        
        .message.user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .message-avatar.coach {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
        }
        
        .message-avatar.user {
            background: var(--text-primary);
            color: white;
        }
        
        .message-content {
            background: var(--background);
            padding: 1rem 1.25rem;
            border-radius: var(--radius-lg);
            flex: 1;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }
        
        .message.user-message .message-content {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border-color: var(--primary);
        }
        
        .message-text {
            margin-bottom: 0.5rem;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
        }
        
        /* Chat Input Container */
        .chat-input-container {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            background: var(--background);
            flex-shrink: 0;
        }
        
        .chat-input {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .chat-input textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            max-height: 150px;
            transition: all 0.3s ease;
            background: var(--surface);
            color: var(--text-primary);
        }
        
        .chat-input textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .chat-input textarea::placeholder {
            color: var(--text-muted);
        }
        
        .input-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .input-tools {
            display: flex;
            gap: 0.5rem;
        }
        
        .tool-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
        }
        
        .tool-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Sidebar for Desktop */
        .coaching-sidebar {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            flex-shrink: 0;
            padding: 1.5rem;
            background: var(--surface);
            border-left: 1px solid var(--border);
            overflow-y: auto;
        }
        
        .sidebar-section {
            background: var(--background);
            padding: 1.5rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }
        
        .sidebar-section h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .goals-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .goal-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: var(--radius);
            transition: background-color 0.2s ease;
            border: 1px solid var(--border);
            background: var(--surface);
        }
        
        .goal-item:hover {
            background: var(--background);
        }
        
        .goal-item input[type="checkbox"] {
            accent-color: var(--primary);
        }
        
        .goal-item label {
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            flex: 1;
            line-height: 1.4;
        }
        
        .topic-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .topic-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: var(--radius-lg);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            line-height: 1.4;
        }
        
        .topic-btn:hover {
            background: var(--background);
            border-color: var(--primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 1rem 1.5rem;
            background: var(--surface);
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-style: italic;
            font-size: 0.9rem;
        }
        
        .typing-indicator.show {
            display: block;
        }
        
        /* MOBILE RESPONSIVE DESIGN */
        @media (max-width: 1024px) {
            .main-content {
                padding: 1rem !important;
            }
            
            .content-header {
                margin-bottom: 1rem !important;
                text-align: center !important;
            }
            
            .content-header h1 {
                font-size: 1.5rem !important;
            }
            
            .header-actions {
                justify-content: center !important;
                flex-wrap: wrap !important;
                gap: 0.75rem !important;
            }
            
            /* Mobile Layout - Full Screen Chat */
            .ai-coach-container {
                height: calc(100vh - 6rem) !important;
                flex-direction: column !important;
                border-radius: var(--radius) !important;
            }
            
            /* Hide sidebar on mobile */
            .coaching-sidebar {
                display: none !important;
            }
            
            /* Chat takes full space */
            .chat-container {
                flex: 1 !important;
                width: 100% !important;
            }
            
            /* Mobile chat header */
            .chat-header {
                padding: 1rem !important;
                flex-direction: column !important;
                gap: 0.75rem !important;
                text-align: center !important;
            }
            
            .coach-info {
                justify-content: center !important;
            }
            
            .coach-avatar {
                width: 40px !important;
                height: 40px !important;
                font-size: 1rem !important;
            }
            
            .coach-details h2 {
                font-size: 1.1rem !important;
            }
            
            /* Mobile messages */
            .chat-messages {
                padding: 1rem !important;
                gap: 1rem !important;
            }
            
            .message {
                max-width: 90% !important;
                gap: 0.75rem !important;
            }
            
            .message-avatar {
                width: 32px !important;
                height: 32px !important;
                font-size: 0.875rem !important;
            }
            
            .message-content {
                padding: 0.875rem 1rem !important;
                font-size: 0.95rem !important;
            }
            
            .message-text {
                font-size: 0.9rem !important;
                line-height: 1.5 !important;
            }
            
            /* Mobile input */
            .chat-input-container {
                padding: 1rem !important;
                background: var(--background) !important;
                border-top: 2px solid var(--border) !important;
                position: relative !important;
                z-index: 10 !important;
            }
            
            .chat-input {
                gap: 0.75rem !important;
            }
            
            .chat-input textarea {
                font-size: 16px !important; /* Prevent zoom on iOS */
                min-height: 44px !important;
                max-height: 120px !important;
                padding: 0.875rem 1rem !important;
                border-radius: var(--radius) !important;
            }
            
            .input-actions {
                flex-direction: row !important;
                justify-content: space-between !important;
                align-items: center !important;
            }
            
            .input-tools {
                gap: 0.75rem !important;
            }
            
            .tool-btn {
                min-width: 44px !important;
                height: 44px !important;
                font-size: 1.1rem !important;
                touch-action: manipulation !important;
            }
            
            .btn {
                min-height: 44px !important;
                padding: 0.75rem 1.5rem !important;
                font-size: 0.95rem !important;
                touch-action: manipulation !important;
            }
            
            /* Safe area padding for devices with notches */
            .chat-input-container {
                padding-bottom: calc(1rem + env(safe-area-inset-bottom)) !important;
            }
            
            /* Better touch scrolling */
            .chat-messages {
                -webkit-overflow-scrolling: touch !important;
            }
            
            /* Hide scrollbars on mobile */
            .chat-messages::-webkit-scrollbar {
                display: none;
            }
            
            .chat-messages {
                scrollbar-width: none;
            }
        }
        
        @media (max-width: 480px) {
            .main-content {
                padding: 0.75rem !important;
            }
            
            .ai-coach-container {
                height: calc(100vh - 4rem) !important;
                border-radius: var(--radius) !important;
            }
            
            .chat-header {
                padding: 0.75rem !important;
            }
            
            .chat-messages {
                padding: 0.75rem !important;
            }
            
            .chat-input-container {
                padding: 0.75rem !important;
            }
            
            .message {
                max-width: 95% !important;
            }
            
            .message-content {
                padding: 0.75rem !important;
                font-size: 0.875rem !important;
            }
            
            .input-tools {
                gap: 0.5rem !important;
            }
            
            .tool-btn {
                min-width: 40px !important;
                height: 40px !important;
                font-size: 1rem !important;
            }
        }
        
        /* Animation */
        @keyframes messageSlide {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        /* Desktop improvements */
        @media (min-width: 1025px) {
            .main-content {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .ai-coach-container {
                width: 100% !important;
                max-width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Universal Hamburger Menu -->
        <button class="universal-hamburger" onclick="toggleSidebar()" aria-label="Toggle navigation menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>

        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>EEH</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html" class="menu-item">Dashboard</a></li>
                <li><a href="ai-coach.html" class="menu-item active">AI Coach</a></li>
                <li><a href="community.html" class="menu-item">Community</a></li>
                <li><a href="goals.html" class="menu-item">Goals</a></li>
                <li><a href="daily-tracker.html" class="menu-item">Daily Tracker</a></li>
                <li><a href="billing.html" class="menu-item">Billing</a></li>
                <li><a href="#" class="menu-item" onclick="logout()">Logout</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>AI Coach</h1>
                <div class="header-actions">
                    <!-- Notification Icon -->
                    <div class="notification-icon-container" onclick="goToNotifications()">
                        <div class="notification-bell">
                            <svg class="bell-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                            </svg>
                            <span class="notification-count" id="headerNotificationCount" style="display: none;">0</span>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="clearChat()">Clear Chat</button>
                    <button class="btn btn-primary" onclick="newSession()">New Session</button>
                </div>
            </header>

            <!-- AI Coach Container -->
            <div class="ai-coach-container">
                <!-- Chat Container -->
                <div class="chat-container">
                    <!-- Chat Header -->
                    <div class="chat-header">
                        <div class="coach-info">
                            <div class="coach-avatar">
                                AI
                            </div>
                            <div class="coach-details">
                                <h2>Your AI Coach</h2>
                                <div class="coach-status">
                                    <div class="status-dot online"></div>
                                    <span>Ready to help</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Messages Area -->
                    <div class="chat-messages" id="chatMessages">
                        <!-- Welcome Message -->
                        <div class="message">
                            <div class="message-avatar coach">AI</div>
                            <div class="message-content">
                                <div class="message-text">
                                    Hello! I'm your AI Coach, here to support you on your entrepreneurial journey. Whether you're dealing with stress, looking to improve work-life balance, or exploring new strategies for growth, I'm ready to engage in meaningful conversations that can help you thrive.
                                    <br><br>
                                    Feel free to share what's on your mind, ask about stress management techniques, discuss business challenges, or explore any aspect of your personal and professional development. How can I support you today?
                                </div>
                                <div class="message-time">Just now</div>
                            </div>
                        </div>
                    </div>

                    <!-- Typing Indicator -->
                    <div class="typing-indicator" id="typingIndicator">
                        AI Coach is typing...
                    </div>

                    <!-- Message Input -->
                    <div class="chat-input-container">
                        <div class="chat-input">
                            <textarea 
                                id="messageInput" 
                                placeholder="Share what's on your mind... Ask about stress management, business dynamics, emotional wellness, or any entrepreneurial challenges."
                                onkeypress="handleKeyPress(event)"
                                style="font-size: 16px;"
                            ></textarea>
                            <div class="input-actions">
                                <div class="input-tools">
                                    <button class="tool-btn" onclick="attachFile()" title="Attach file">ðŸ“Ž</button>
                                    <button class="tool-btn" onclick="addEmoji()" title="Add emoji">ðŸ˜Š</button>
                                </div>
                                <button class="btn btn-primary" onclick="sendMessage()" id="sendButton">
                                    Send Message
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coaching Sidebar - Desktop Only -->
                <div class="coaching-sidebar">
                    <!-- Quick Goals -->
                    <div class="sidebar-section">
                        <h3>Today's Goals</h3>
                        <div class="goals-list">
                            <div class="goal-item">
                                <input type="checkbox" id="goal1">
                                <label for="goal1">Practice deep breathing exercise</label>
                            </div>
                            <div class="goal-item">
                                <input type="checkbox" id="goal2">
                                <label for="goal2">Review business priorities</label>
                            </div>
                            <div class="goal-item">
                                <input type="checkbox" id="goal3">
                                <label for="goal3">Take a 15-minute break</label>
                            </div>
                        </div>
                    </div>

                    <!-- Suggested Topics -->
                    <div class="sidebar-section">
                        <h3>Suggested Topics</h3>
                        <div class="topic-buttons">
                            <button class="topic-btn" onclick="suggestTopic('stress')">
                                Managing startup stress and pressure
                            </button>
                            <button class="topic-btn" onclick="suggestTopic('balance')">
                                Work-life balance strategies
                            </button>
                            <button class="topic-btn" onclick="suggestTopic('decisions')">
                                Making difficult business decisions
                            </button>
                            <button class="topic-btn" onclick="suggestTopic('growth')">
                                Personal growth and resilience
                            </button>
                            <button class="topic-btn" onclick="suggestTopic('team')">
                                Leading and motivating teams
                            </button>
                        </div>
                    </div>

                    <!-- Recent Insights -->
                    <div class="sidebar-section">
                        <h3>Recent Insights</h3>
                        <div class="insight-item">
                            <p>"Taking regular breaks can increase productivity by up to 25%"</p>
                            <small>2 days ago</small>
                        </div>
                        <div class="insight-item">
                            <p>"Mindful breathing reduces stress hormones significantly"</p>
                            <small>3 days ago</small>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let messageCount = 1;
        
        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (window.innerWidth <= 768) {
                // Mobile behavior
                sidebar.classList.toggle('open');
                
                // Add/remove overlay
                let overlay = document.querySelector('.mobile-overlay');
                if (!overlay) {
                    overlay = document.createElement('div');
                    overlay.className = 'mobile-overlay';
                    overlay.onclick = () => {
                        sidebar.classList.remove('open');
                        overlay.classList.remove('active');
                    };
                    document.body.appendChild(overlay);
                }
                
                if (sidebar.classList.contains('open')) {
                    overlay.classList.add('active');
                } else {
                    overlay.classList.remove('active');
                }
            } else {
                // Desktop behavior
                if (mainContent.classList.contains('shifted')) {
                    mainContent.classList.remove('shifted');
                    sidebar.style.transform = 'translateX(-280px)';
                } else {
                    mainContent.classList.add('shifted');
                    sidebar.style.transform = 'translateX(0)';
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                const isMobile = window.innerWidth <= 1024;
                
                if (isMobile) {
                    return; // Allow multi-line on mobile
                } else {
                    if (!event.shiftKey) {
                        event.preventDefault();
                        sendMessage();
                    }
                }
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const chatMessages = document.getElementById('chatMessages');
            const sendButton = document.getElementById('sendButton');
            const typingIndicator = document.getElementById('typingIndicator');
            
            const messageText = messageInput.value.trim();
            if (!messageText) return;
            
            // Create user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.innerHTML = `
                <div class="message-avatar user">U</div>
                <div class="message-content">
                    <div class="message-text">${escapeHtml(messageText)}</div>
                    <div class="message-time">Just now</div>
                </div>
            `;
            
            chatMessages.appendChild(userMessage);
            
            // Clear input and show typing
            messageInput.value = '';
            sendButton.disabled = true;
            sendButton.textContent = 'Sending...';
            typingIndicator.classList.add('show');
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simulate AI response
            setTimeout(() => {
                typingIndicator.classList.remove('show');
                
                const aiMessage = document.createElement('div');
                aiMessage.className = 'message';
                aiMessage.innerHTML = `
                    <div class="message-avatar coach">AI</div>
                    <div class="message-content">
                        <div class="message-text">${generateAIResponse(messageText)}</div>
                        <div class="message-time">Just now</div>
                    </div>
                `;
                
                chatMessages.appendChild(aiMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                sendButton.disabled = false;
                sendButton.textContent = 'Send Message';
                messageCount++;
            }, 2000 + Math.random() * 2000);
        }

        function generateAIResponse(userMessage) {
            const responses = [
                "That's a really insightful perspective. As an entrepreneur, dealing with these challenges requires both emotional intelligence and practical strategies. Let me share some approaches that might help...",
                "I understand the pressure you're experiencing. Many successful entrepreneurs face similar situations. Here are some evidence-based techniques that can help you navigate this...",
                "Thank you for sharing that with me. It takes courage to be vulnerable about these challenges. Let's explore some strategies that can support you through this...",
                "What you're describing is quite common in the entrepreneurial journey. The key is developing resilience while maintaining your well-being. Consider these approaches...",
                "I appreciate you opening up about this. Managing both business demands and personal wellness is crucial for long-term success. Here's what I'd recommend..."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function suggestTopic(topic) {
            const messageInput = document.getElementById('messageInput');
            const topics = {
                'stress': "I've been feeling overwhelmed with startup stress lately. Can you help me develop some coping strategies?",
                'balance': "I'm struggling to maintain work-life balance while building my business. What approaches would you recommend?",
                'decisions': "I have some difficult business decisions to make and I'm feeling uncertain. Can we talk through some decision-making frameworks?",
                'growth': "I want to focus on personal growth and building resilience as an entrepreneur. Where should I start?",
                'team': "I'm having challenges leading and motivating my team effectively. Can you share some leadership strategies?"
            };
            
            messageInput.value = topics[topic] || '';
            messageInput.focus();
        }

        function clearChat() {
            if (confirm('Are you sure you want to clear the chat history?')) {
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.innerHTML = `
                    <div class="message">
                        <div class="message-avatar coach">AI</div>
                        <div class="message-content">
                            <div class="message-text">
                                Hello! I'm your AI Coach, here to support you on your entrepreneurial journey. Whether you're dealing with stress, looking to improve work-life balance, or exploring new strategies for growth, I'm ready to engage in meaningful conversations that can help you thrive.
                                <br><br>
                                Feel free to share what's on your mind, ask about stress management techniques, discuss business challenges, or explore any aspect of your personal and professional development. How can I support you today?
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                `;
                messageCount = 1;
            }
        }

        function newSession() {
            clearChat();
        }

        function attachFile() {
            alert('File attachment feature coming soon!');
        }

        function addEmoji() {
            const messageInput = document.getElementById('messageInput');
            const emojis = ['ðŸ˜Š', 'ðŸ¤”', 'ðŸ’ª', 'ðŸŽ¯', 'ðŸš€', 'ðŸ’¡', 'â¤ï¸', 'ðŸ‘'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const cursorPos = messageInput.selectionStart || messageInput.value.length;
            const textBefore = messageInput.value.substring(0, cursorPos);
            const textAfter = messageInput.value.substring(messageInput.selectionEnd || cursorPos);
            messageInput.value = textBefore + randomEmoji + textAfter;
            
            const newPos = cursorPos + randomEmoji.length;
            messageInput.setSelectionRange(newPos, newPos);
            messageInput.focus();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function goToNotifications() {
            window.location.href = 'notifications.html';
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }

        // Notification count functionality
        async function updateNotificationCount() {
            try {
                const token = localStorage.getItem('authToken') || localStorage.getItem('eeh_token');
                if (!token) return;
                
                const response = await fetch('https://ai-coach-backend-pbse.onrender.com/api/notifications/unread-count', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const count = data.count || 0;
                    const countElement = document.getElementById('headerNotificationCount');
                    
                    if (countElement) {
                        countElement.textContent = count;
                        countElement.setAttribute('data-count', count);
                        countElement.style.display = count > 0 ? 'flex' : 'none';
                    }
                }
            } catch (error) {
                console.error('Error fetching notification count:', error);
            }
        }

        // Auto-resize textarea
        function autoResizeTextarea() {
            const textarea = document.getElementById('messageInput');
            if (textarea) {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateNotificationCount();
            setInterval(updateNotificationCount, 30000);
            autoResizeTextarea();
            
            // Focus message input on desktop
            if (window.innerWidth > 1024) {
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.focus();
                }
            }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            // Adjust layout if needed
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                setTimeout(() => {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
            }
        });

        // Prevent form submission on enter in mobile
        document.getElementById('messageInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && window.innerWidth <= 1024) {
                e.stopPropagation();
            }
        });
