<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Coach - Entrepreneur Emotional Health</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* MOBILE DESIGN FIX ONLY - Keep all original functionality */
        @media (max-width: 1024px) {
            /* Remove margins and make full width */
            .main-content {
                margin-left: 0 !important;
                padding: 0 !important;
                width: 100vw !important;
                max-width: 100vw !important;
                height: 100vh !important;
                display: flex !important;
                flex-direction: column !important;
            }
            
            /* Hide header on mobile to save space */
            .content-header {
                display: none !important;
            }
            
            /* Chat container - full screen */
            .chat-container {
                height: 100vh !important;
                width: 100vw !important;
                max-width: 100vw !important;
                margin: 0 !important;
                border-radius: 0 !important;
                border: none !important;
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                overflow: hidden !important;
            }
            
            /* Hide sidebar on mobile */
            .coaching-sidebar {
                display: none !important;
            }
            
            /* Chat header - compact */
            .chat-header {
                padding: 1rem !important;
                flex-shrink: 0 !important;
                background: var(--surface) !important;
                border-bottom: 1px solid var(--border) !important;
                text-align: center !important;
            }
            
            /* Messages area - scrollable middle */
            .chat-messages {
                flex: 1 !important;
                padding: 1rem !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
                background: var(--surface) !important;
                width: 100% !important;
            }
            
            /* Input container - fixed at bottom */
            .chat-input-container {
                position: sticky !important;
                bottom: 0 !important;
                width: 100% !important;
                padding: 1rem !important;
                background: var(--background) !important;
                border-top: 2px solid var(--border) !important;
                flex-shrink: 0 !important;
                z-index: 1000 !important;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
            }
            
            /* Input styling */
            .chat-input textarea {
                width: 100% !important;
                font-size: 16px !important;
                min-height: 44px !important;
                box-sizing: border-box !important;
            }
            
            /* Button styling */
            .input-actions .btn {
                min-height: 44px !important;
                touch-action: manipulation !important;
            }
            
            /* Safe area for notched devices */
            .chat-input-container {
                padding-bottom: calc(1rem + env(safe-area-inset-bottom)) !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>EEH</h2>
                <button class="sidebar-toggle" aria-label="Toggle navigation menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html" class="menu-item">
                    Dashboard
                </a></li>
                <li><a href="ai-coach.html" class="menu-item active">
                    AI Coach
                </a></li>
                <li><a href="community.html" class="menu-item">
                    Community
                </a></li>
               <li><a href="goals.html" class="menu-item">Goals</a></li>
<li><a href="daily-tracker.html" class="menu-item">Daily Tracker</a></li>
<li><a href="billing.html" class="menu-item">Billing</a></li>
                <li><a href="#" class="menu-item" onclick="logout()">
                    Logout
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>AI Coach</h1>
                <div class="header-actions">
                    <!-- Notification Icon -->
                    <div class="notification-icon-container" onclick="goToNotifications()">
                        <div class="notification-bell">
                         <svg class="bell-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/> </svg>
                            <span class="notification-count" id="headerNotificationCount" style="display: none;">0</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="clearChat()">
                        Clear Chat
                    </button>
                    <button class="btn btn-primary" onclick="newSession()">
                        New Session
                    </button>
                </div>
            </header>

            <div class="chat-container">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="coach-info">
                        <div class="coach-avatar">
                            AI
                        </div>
                        <div class="coach-details">
                            <h2>Your AI Coach</h2>
                            <div class="coach-status">
                                <div class="status-dot online"></div>
                                <span>Ready to help</span>
                            </div>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn btn-small btn-outline" onclick="exportChat()">
                            Export
                        </button>
                    </div>
                </div>

                <!-- Messages -->
                <div class="chat-messages" id="chatMessages">
                    <div class="message">
                        <div class="coach-avatar">AI</div>
                        <div class="message-content">
                            <div class="message-text">Hello! I'm your AI Coach, here to support you on your entrepreneurial journey. Whether you're dealing with stress, looking to improve work-life balance, or exploring new strategies for growth, I'm ready to engage in meaningful conversations that can help you thrive.

Feel free to share what's on your mind, ask about stress management techniques, discuss business challenges, or explore any aspect of your personal and professional development. How can I support you today?</div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <div class="chat-input">
                        <textarea 
                            id="messageInput" 
                            placeholder="Share what's on your mind... Ask about stress management, business dynamics, emotional wellness, or any entrepreneurial challenges."
                            onkeypress="handleKeyPress(event)"
                        ></textarea>
                        <div class="input-actions">
                            <button class="btn btn-small btn-outline" onclick="attachFile()">
                                📎
                            </button>
                            <button class="btn btn-small btn-outline" onclick="addEmoji()">
                                😊
                            </button>
                            <button class="btn btn-primary" onclick="sendMessage()">
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coaching Sidebar -->
            <div class="coaching-sidebar">
                <!-- Quick Goals -->
                <div class="sidebar-section">
                    <h3>Today's Goals</h3>
                    <div class="goals-list">
                        <div class="goal-item">
                            <input type="checkbox" id="goal1">
                            <label for="goal1">Practice deep breathing exercise</label>
                        </div>
                        <div class="goal-item">
                            <input type="checkbox" id="goal2">
                            <label for="goal2">Review business priorities</label>
                        </div>
                        <div class="goal-item">
                            <input type="checkbox" id="goal3">
                            <label for="goal3">Take a 15-minute break</label>
                        </div>
                    </div>
                </div>

                <!-- Suggested Topics -->
                <div class="sidebar-section">
                    <h3>Suggested Topics</h3>
                    <div class="topic-buttons">
                        <button class="topic-btn" onclick="suggestTopic('stress')">
                            Managing Startup Stress
                        </button>
                        <button class="topic-btn" onclick="suggestTopic('balance')">
                            Work-Life Balance
                        </button>
                        <button class="topic-btn" onclick="suggestTopic('decisions')">
                            Decision Making
                        </button>
                        <button class="topic-btn" onclick="suggestTopic('growth')">
                            Personal Growth
                        </button>
                        <button class="topic-btn" onclick="suggestTopic('leadership')">
                            Leadership Skills
                        </button>
                    </div>
                </div>

                <!-- Recent Insights -->
                <div class="sidebar-section">
                    <h3>Recent Insights</h3>
                    <div class="insights-list">
                        <div class="insight-item">
                            <p>"Taking regular breaks can increase productivity by up to 25%"</p>
                            <small>2 days ago</small>
                        </div>
                        <div class="insight-item">
                            <p>"Mindful breathing reduces stress hormones significantly"</p>
                            <small>3 days ago</small>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="api-service.js"></script>
    <script src="sidebar-toggle.js"></script>
    <script src="notifications.js"></script>
    
    <script>
    // Keep ALL original JavaScript functionality

    // Simple notification counter
    async function updateNotificationCount() {
        try {
            const token = localStorage.getItem('authToken') || localStorage.getItem('eeh_token');
            if (!token) return;
            
            const response = await fetch('https://ai-coach-backend-PBSE.onrender.com/api/notifications/unread-count', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                const count = data.count || 0;
                const countElement = document.getElementById('headerNotificationCount');
                
                if (countElement) {
                    countElement.textContent = count;
                    countElement.setAttribute('data-count', count);
                    countElement.style.display = count > 0 ? 'flex' : 'none';
                }
            }
        } catch (error) {
            console.error('Error fetching notification count:', error);
        }
    }

    function goToNotifications() {
        window.location.href = 'notifications.html';
    }

    function logout() {
        localStorage.removeItem('authToken');
        localStorage.removeItem('eeh_token');
        localStorage.removeItem('userData');
        window.location.href = 'login.html';
    }

    // AI Coach functionality
    let messageCount = 1;
    let isTyping = false;

    function handleKeyPress(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendMessage();
        }
    }

    function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const chatMessages = document.getElementById('chatMessages');
        
        if (!messageInput || !chatMessages) return;
        
        const messageText = messageInput.value.trim();
        if (!messageText || isTyping) return;

        // Add user message
        const userMessage = document.createElement('div');
        userMessage.className = 'message user-message';
        userMessage.innerHTML = `
            <div class="message-content">
                <div class="message-text">${escapeHtml(messageText)}</div>
                <div class="message-time">Just now</div>
            </div>
        `;
        
        chatMessages.appendChild(userMessage);
        messageInput.value = '';
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Show typing indicator and simulate AI response
        showTypingIndicator();
        
        setTimeout(() => {
            hideTypingIndicator();
            addAIResponse(generateAIResponse(messageText));
        }, 1000 + Math.random() * 2000);
    }

    function showTypingIndicator() {
        isTyping = true;
        const chatMessages = document.getElementById('chatMessages');
        
        const typingDiv = document.createElement('div');
        typingDiv.id = 'typingIndicator';
        typingDiv.className = 'message';
        typingDiv.innerHTML = `
            <div class="coach-avatar">AI</div>
            <div class="message-content">
                <div class="message-text" style="font-style: italic; opacity: 0.7;">
                    AI Coach is typing...
                </div>
            </div>
        `;
        
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function hideTypingIndicator() {
        const typingIndicator = document.getElementById('typingIndicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
        isTyping = false;
    }

    function addAIResponse(responseText) {
        const chatMessages = document.getElementById('chatMessages');
        
        const aiMessage = document.createElement('div');
        aiMessage.className = 'message';
        aiMessage.innerHTML = `
            <div class="coach-avatar">AI</div>
            <div class="message-content">
                <div class="message-text">${responseText}</div>
                <div class="message-time">Just now</div>
            </div>
        `;
        
        chatMessages.appendChild(aiMessage);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        messageCount++;
    }

    function generateAIResponse(userMessage) {
        const responses = [
            "That's a really insightful perspective. As an entrepreneur, dealing with these challenges requires both emotional intelligence and practical strategies. Let me share some approaches that might help...",
            "I understand the pressure you're experiencing. Many successful entrepreneurs face similar situations. Here are some evidence-based techniques that can help you navigate this...",
            "Thank you for sharing that with me. It takes courage to be vulnerable about these challenges. Let's explore some strategies that can support you through this...",
            "What you're describing is quite common in the entrepreneurial journey. The key is developing resilience while maintaining your well-being. Consider these approaches...",
            "I appreciate you opening up about this. Managing both business demands and personal wellness is crucial for long-term success. Here's what I'd recommend..."
        ];
        
        return responses[Math.floor(Math.random() * responses.length)];
    }

    function suggestTopic(topic) {
        const messageInput = document.getElementById('messageInput');
        const topics = {
            'stress': "I've been feeling overwhelmed with startup stress lately. Can you help me develop some coping strategies?",
            'balance': "I'm struggling to maintain work-life balance while building my business. What approaches would you recommend?",
            'decisions': "I have some difficult business decisions to make and I'm feeling uncertain. Can we talk through some decision-making frameworks?",
            'growth': "I want to focus on personal growth and building resilience as an entrepreneur. Where should I start?",
            'leadership': "I'm having challenges leading and motivating my team effectively. Can you share some leadership strategies?"
        };
        
        if (messageInput && topics[topic]) {
            messageInput.value = topics[topic];
            messageInput.focus();
        }
    }

    function clearChat() {
        if (confirm('Are you sure you want to clear the chat history?')) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="message">
                    <div class="coach-avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">Hello! I'm your AI Coach, here to support you on your entrepreneurial journey. Whether you're dealing with stress, looking to improve work-life balance, or exploring new strategies for growth, I'm ready to engage in meaningful conversations that can help you thrive.

Feel free to share what's on your mind, ask about stress management techniques, discuss business challenges, or explore any aspect of your personal and professional development. How can I support you today?</div>
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            `;
            messageCount = 1;
        }
    }

    function newSession() {
        clearChat();
    }

    function exportChat() {
        alert('Export feature coming soon!');
    }

    function attachFile() {
        alert('File attachment feature coming soon!');
    }

    function addEmoji() {
        const messageInput = document.getElementById('messageInput');
        const emojis = ['😊', '🤔', '💪', '🎯', '🚀', '💡', '❤️', '👍'];
        const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
        
        if (messageInput) {
            const cursorPos = messageInput.selectionStart || messageInput.value.length;
            const textBefore = messageInput.value.substring(0, cursorPos);
            const textAfter = messageInput.value.substring(messageInput.selectionEnd || cursorPos);
            messageInput.value = textBefore + randomEmoji + textAfter;
            
            const newPos = cursorPos + randomEmoji.length;
            messageInput.setSelectionRange(newPos, newPos);
            messageInput.focus();
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Update count when page loads and every 30 seconds
    document.addEventListener('DOMContentLoaded', function() {
        updateNotificationCount();
        setInterval(updateNotificationCount, 30000);
        
        // Auto-resize textarea
        const messageInput = document.getElementById('messageInput');
        if (messageInput) {
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        }
    });
    </script>
</body>
</html>
