<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%236366f1'/><stop offset='100%25' stop-color='%234f46e5'/></linearGradient></defs><rect width='32' height='32' fill='url(%23g)'/><text x='16' y='20' font-family='Arial' font-size='10' font-weight='bold' text-anchor='middle' fill='white'>EEH</text></svg>">
    <title>Notifications - Entrepreneur Emotional Health</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Universal Hamburger Menu -->
        <button class="universal-hamburger" onclick="toggleSidebar()" aria-label="Toggle navigation menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>

        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>EEH</h2>
                <button class="sidebar-toggle" aria-label="Toggle navigation menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html" class="menu-item">
                    Dashboard
                </a></li>
                <li><a href="ai-coach.html" class="menu-item">
                    AI Coach
                </a></li>
                <li><a href="community.html" class="menu-item">
                    Community
                </a></li>
                <li><a href="goals.html" class="menu-item">Goals</a></li>
                <li><a href="daily-tracker.html" class="menu-item">Daily Tracker</a></li>
                <li><a href="daily-prompt.html" class="menu-item">Daily Prompt</a></li>
                <li><a href="billing.html" class="menu-item">Billing</a></li>
                <li><a href="settings.html" class="menu-item">Settings</a></li>
                <li><a href="#" class="menu-item" onclick="logout()">
                    Logout
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>Notifications</h1>
                <div class="header-actions">
                    <!-- Notification Icon (on notifications page, just show without count) -->
                    <div class="notification-icon-container" style="opacity: 0.5;">
                        <div class="notification-bell">
                          <svg class="bell-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/> </svg>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="markAllRead()" id="markAllReadBtn">
                        Mark All Read
                    </button>
                    <button class="btn btn-outline" onclick="clearAll()">
                        Clear All
                    </button>
                </div>
            </header>

            <div class="notifications-container">
                <!-- Notification Filters -->
                <div class="notification-filters">
                    <button class="filter-btn active" onclick="filterNotifications('all')">
                        All Notifications
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('unread')">
                        Unread
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('coaching')">
                        AI Coach
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('community')">
                        Community
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('system')">
                        System
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('billing')">
                        Billing
                    </button>
                </div>

                <!-- Notifications List -->
                <div class="notifications-list" id="notificationsList">
                    <!-- Unread Coaching Notification -->
                    <div class="notification-item unread" data-type="coaching" data-id="1">
                        <div class="notification-icon coaching">
                            <div class="icon-text">AI</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>New Coaching Insights Available</h3>
                                <span class="notification-time">2 hours ago</span>
                            </div>
                            <p>Your AI coach has generated new insights based on your recent conversations. Review your personalized recommendations for emotional wellness and business growth.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToCoach()">View Insights</button>
                                <button class="btn-link" onclick="markAsRead(this)">Mark as Read</button>
                            </div>
                        </div>
                    </div>

                    <!-- Unread Community Notification -->
                    <div class="notification-item unread" data-type="community" data-id="2">
                        <div class="notification-icon community">
                            <div class="icon-text">CM</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>New Messages in Business Growth</h3>
                                <span class="notification-time">4 hours ago</span>
                            </div>
                            <p>Sarah Johnson and 3 others have shared new insights in the Business Growth room. Join the conversation about scaling strategies.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToCommunity()">Join Conversation</button>
                                <button class="btn-link" onclick="markAsRead(this)">Mark as Read</button>
                            </div>
                        </div>
                    </div>

                    <!-- Unread System Notification -->
                    <div class="notification-item unread" data-type="system" data-id="3">
                        <div class="notification-icon system">
                            <div class="icon-text">SY</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>Weekly Progress Report Ready</h3>
                                <span class="notification-time">1 day ago</span>
                            </div>
                            <p>Your weekly emotional health and business progress report is now available. See your growth patterns and achievements.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToDashboard()">View Report</button>
                                <button class="btn-link" onclick="markAsRead(this)">Mark as Read</button>
                            </div>
                        </div>
                    </div>

                    <!-- Read Coaching Notification -->
                    <div class="notification-item read" data-type="coaching" data-id="4">
                        <div class="notification-icon coaching">
                            <div class="icon-text">AI</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>Goal Achievement Milestone</h3>
                                <span class="notification-time">2 days ago</span>
                            </div>
                            <p>Congratulations! You've completed 75% of your quarterly emotional wellness goals. Your AI coach has updated your action plan.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToCoach()">View Progress</button>
                            </div>
                        </div>
                    </div>

                    <!-- Read Community Notification -->
                    <div class="notification-item read" data-type="community" data-id="5">
                        <div class="notification-icon community">
                            <div class="icon-text">CM</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>Someone Mentioned You</h3>
                                <span class="notification-time">3 days ago</span>
                            </div>
                            <p>Mike Chen mentioned you in the Success Stories room. Check out the discussion about overcoming entrepreneurial challenges.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToCommunity()">View Message</button>
                            </div>
                        </div>
                    </div>

                    <!-- Read Community Notification -->
                    <div class="notification-item read" data-type="community" data-id="6">
                        <div class="notification-icon community">
                            <div class="icon-text">CM</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>New Room Created: Mindfulness</h3>
                                <span class="notification-time">4 days ago</span>
                            </div>
                            <p>A new community room "Mindfulness & Meditation" has been created. Join entrepreneurs discussing stress management techniques.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToCommunity()">Explore Room</button>
                            </div>
                        </div>
                    </div>

                    <!-- Read System Notification -->
                    <div class="notification-item read" data-type="system" data-id="7">
                        <div class="notification-icon system">
                            <div class="icon-text">SY</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>Platform Update: New Features</h3>
                                <span class="notification-time">1 week ago</span>
                            </div>
                            <p>We've added new emotional intelligence tracking features and enhanced AI coaching capabilities. Explore the improvements in your dashboard.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToDashboard()">See What's New</button>
                            </div>
                        </div>
                    </div>

                    <!-- Read Billing Notification -->
                    <div class="notification-item read" data-type="billing" data-id="8">
                        <div class="notification-icon billing">
                            <div class="icon-text">BI</div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-header">
                                <h3>Payment Successful</h3>
                                <span class="notification-time">1 week ago</span>
                            </div>
                            <p>Your yearly subscription payment of $929 has been processed successfully. Thank you for continuing your emotional health journey with us.</p>
                            <div class="notification-actions">
                                <button class="btn-link" onclick="goToBilling()">View Receipt</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty State (Hidden by default) -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <h3>No notifications found</h3>
                    <p>You're all caught up! Check back later for updates on your emotional health journey.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Settings Modal -->
    <div class="modal" id="settingsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Notification Settings</h3>
                <button class="close-btn" onclick="closeSettingsModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> AI Coach Insights
                    </label>
                    <small>Get notified when new coaching insights are available</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> Community Messages
                    </label>
                    <small>Receive notifications for community activity</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> Weekly Reports
                    </label>
                    <small>Get your weekly progress summaries</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> Billing Updates
                    </label>
                    <small>Payment confirmations and billing reminders</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSettingsModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <script src="api-service.js"></script>
    <script src="sidebar-toggle.js"></script>
    
    <script>
        
<script>
// Enhanced notifications page that syncs with backend
const API_BASE_URL = 'https://ai-coach-backend-pbse.onrender.com';
let allNotifications = [];
let currentFilter = 'all';

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔔 Notifications page loading...');
    loadNotificationsFromBackend();
    
    // Track notification check for dashboard
    localStorage.setItem('eeh_pending_notification', JSON.stringify({
        timestamp: new Date().toISOString()
    }));
});

// Load notifications from backend API
async function loadNotificationsFromBackend() {
    try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('eeh_token');
        if (!token) {
            console.error('No auth token found');
            showFallbackNotifications();
            return;
        }

        console.log('📡 Loading notifications from backend...');
        const response = await fetch(`${API_BASE_URL}/api/notifications`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            allNotifications = await response.json();
            console.log('✅ Loaded notifications from backend:', allNotifications.length);
            renderNotifications();
        } else {
            console.log('❌ Backend not available, showing fallback notifications');
            showFallbackNotifications();
        }

    } catch (error) {
        console.error('❌ Error loading notifications:', error);
        showFallbackNotifications();
    }
}

// Show the existing hardcoded notifications as fallback
function showFallbackNotifications() {
    console.log('📋 Using fallback notifications');
    // Keep the existing hardcoded notifications that are already in the HTML
    updateFilterButtons();
}

// Render notifications from backend
function renderNotifications() {
    const notificationsList = document.getElementById('notificationsList');
    const emptyState = document.getElementById('emptyState');
    
    if (!notificationsList) return;

    // Filter notifications based on current filter
    const filteredNotifications = getFilteredNotifications();

    if (filteredNotifications.length === 0) {
        notificationsList.style.display = 'none';
        emptyState.style.display = 'block';
        return;
    }

    emptyState.style.display = 'none';
    notificationsList.style.display = 'block';

    // Render notifications
    notificationsList.innerHTML = filteredNotifications.map(notification => {
        const isUnread = !notification.isRead;
        const timeAgo = formatTimeAgo(notification.createdAt);
        const iconConfig = getNotificationIcon(notification.type);

        return `
            <div class="notification-item ${isUnread ? 'unread' : 'read'}" data-type="${notification.type}" data-id="${notification._id}">
                <div class="notification-icon ${notification.type}">
                    <div class="icon-text">${iconConfig.text}</div>
                </div>
                <div class="notification-content">
                    <div class="notification-header">
                        <h3>${escapeHtml(notification.title)}</h3>
                        <span class="notification-time">${timeAgo}</span>
                    </div>
                    <p>${escapeHtml(notification.message || notification.content)}</p>
                    <div class="notification-actions">
                        ${getNotificationActions(notification)}
                        ${isUnread ? `<button class="btn-link" onclick="markAsRead(this)">Mark as Read</button>` : ''}
                    </div>
                </div>
            </div>
        `;
    }).join('');

    updateFilterButtons();
}

// Get filtered notifications based on current filter
function getFilteredNotifications() {
    if (currentFilter === 'all') return allNotifications;
    if (currentFilter === 'unread') return allNotifications.filter(n => !n.isRead);
    return allNotifications.filter(n => n.type === currentFilter);
}

// Get notification icon configuration
function getNotificationIcon(type) {
    const icons = {
        coaching: { text: 'AI' },
        community: { text: 'CM' },
        system: { text: 'SY' },
        billing: { text: 'BI' },
        goal: { text: 'GL' },
        prompt: { text: 'DP' }
    };
    return icons[type] || { text: 'SY' };
}

// Get appropriate actions for notification type
function getNotificationActions(notification) {
    switch (notification.type) {
        case 'coaching':
            return '<button class="btn-link" onclick="goToCoach()">View Insights</button>';
        case 'community':
            return '<button class="btn-link" onclick="goToCommunity()">Join Conversation</button>';
        case 'system':
            return '<button class="btn-link" onclick="goToDashboard()">View Report</button>';
        case 'billing':
            return '<button class="btn-link" onclick="goToBilling()">View Details</button>';
        case 'goal':
            return '<button class="btn-link" onclick="goToGoals()">View Goals</button>';
        case 'prompt':
            return '<button class="btn-link" onclick="goToPrompt()">View Prompt</button>';
        default:
            return '<button class="btn-link" onclick="goToDashboard()">View</button>';
    }
}

// Format time ago
function formatTimeAgo(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffInMinutes = Math.floor((now - date) / (1000 * 60));

    if (diffInMinutes < 1) return 'Just now';
    if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
    if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
    if (diffInMinutes < 10080) return `${Math.floor(diffInMinutes / 1440)}d ago`;
    return date.toLocaleDateString();
}

// Update filter button states
function updateFilterButtons() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Find and activate current filter button
    const activeButton = document.querySelector(`.filter-btn[onclick*="'${currentFilter}'"]`);
    if (activeButton) {
        activeButton.classList.add('active');
    }
}

// Filter notifications
function filterNotifications(type) {
    currentFilter = type;
    
    if (allNotifications.length > 0) {
        // Using backend notifications
        renderNotifications();
    } else {
        // Using hardcoded notifications (fallback)
        const notifications = document.querySelectorAll('.notification-item');
        let visibleCount = 0;

        notifications.forEach(notification => {
            const shouldShow = type === 'all' || 
                              (type === 'unread' && notification.classList.contains('unread')) ||
                              notification.dataset.type === type;
            
            notification.style.display = shouldShow ? 'flex' : 'none';
            if (shouldShow) visibleCount++;
        });

        // Show empty state if no notifications visible
        const emptyState = document.getElementById('emptyState');
        const notificationsList = document.getElementById('notificationsList');
        
        if (visibleCount === 0) {
            notificationsList.style.display = 'none';
            emptyState.style.display = 'block';
        } else {
            notificationsList.style.display = 'block';
            emptyState.style.d
    </script>
</body>
</html>
