<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - Entrepreneur Emotional Health</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- ADD THIS: Notification Manager -->
    <script src="notification-manager.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (window.notificationManager) {
                window.notificationManager.init();
                setTimeout(() => window.notificationManager.updateBadge(), 100);
            }
        });
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>EEH</h2>
                <button class="sidebar-toggle" aria-label="Toggle navigation menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html" class="menu-item">
                    Dashboard
                </a></li>
                <li><a href="ai-coach.html" class="menu-item">
                    AI Coach
                </a></li>
                <li><a href="community.html" class="menu-item">
                    Community
                </a></li>
                <li><a href="notifications.html" class="menu-item active">
                    Notifications
                    <span class="notification-badge" id="notificationBadge">0</span>
                </a></li>
                <li><a href="billing.html" class="menu-item">
                    Billing
                </a></li>
                <li><a href="#" class="menu-item" onclick="logout()">
                    Logout
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>Notifications</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="markAllRead()" id="markAllReadBtn">
                        Mark All Read
                    </button>
                    <button class="btn btn-outline" onclick="clearAll()">
                        Clear All
                    </button>
                </div>
            </header>

            <div class="notifications-container">
                <!-- Notification Filters -->
                <div class="notification-filters">
                    <button class="filter-btn active" onclick="filterNotifications('all')">
                        All Notifications
                        <span class="count" id="allCount">8</span>
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('unread')">
                        Unread
                        <span class="count" id="unreadCount">3</span>
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('coaching')">
                        AI Coach
                        <span class="count" id="coachingCount">2</span>
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('community')">
                        Community
                        <span class="count" id="communityCount">3</span>
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('system')">
                        System
                        <span class="count" id="systemCount">2</span>
                    </button>
                    <button class="filter-btn" onclick="filterNotifications('billing')">
                        Billing
                        <span class="count" id="billingCount">1</span>
                    </button>
                </div>

                <!-- Notifications List -->
                <div class="notifications-list" id="notificationsList">
                    <!-- Notifications will be populated by JavaScript from notification manager -->
                </div>

                <!-- Empty State (Hidden by default) -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <h3>No notifications found</h3>
                    <p>You're all caught up! Check back later for updates on your emotional health journey.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Settings Modal -->
    <div class="modal" id="settingsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Notification Settings</h3>
                <button class="close-btn" onclick="closeSettingsModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> AI Coach Insights
                    </label>
                    <small>Get notified when new coaching insights are available</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> Community Messages
                    </label>
                    <small>Receive notifications for community activity</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> Weekly Reports
                    </label>
                    <small>Get your weekly progress summaries</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" checked> Billing Updates
                    </label>
                    <small>Payment confirmations and billing reminders</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSettingsModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <script src="sidebar-toggle.js"></script>
    <script src="notifications.js"></script>
    
    <script>
    // Common logout function
    function logout() {
        localStorage.removeItem('authToken');
        localStorage.removeItem('eeh_token');
        localStorage.removeItem('userData');
        localStorage.removeItem('eeh_notifications');
        localStorage.removeItem('eeh_rooms');
        window.location.href = 'login.html';
    }

    // Notification management functions that work with notification manager
    function markAllRead() {
        if (window.notificationManager) {
            window.notificationManager.markAllAsRead();
            loadNotifications(); // Refresh display
        }
    }

    function clearAll() {
        if (confirm('Are you sure you want to clear all notifications? This action cannot be undone.')) {
            if (window.notificationManager) {
                window.notificationManager.notifications = [];
                window.notificationManager.unreadCount = 0;
                window.notificationManager.saveNotifications();
                window.notificationManager.updateBadge();
                loadNotifications();
            }
        }
    }

    function markAsRead(element) {
        const notificationItem = element.closest('.notification-item');
        const notificationId = parseInt(notificationItem.getAttribute('data-id'));
        
        if (window.notificationManager) {
            window.notificationManager.markAsRead(notificationId);
            notificationItem.classList.remove('unread');
            notificationItem.classList.add('read');
            
            // Remove the "Mark as Read" button
            element.remove();
        }
    }

    function goToCoach() {
        window.location.href = 'ai-coach.html';
    }

    function goToCommunity() {
        window.location.href = 'community.html';
    }

    function goToDashboard() {
        window.location.href = 'dashboard.html';
    }

    function goToBilling() {
        window.location.href = 'billing.html';
    }

    function filterNotifications(type) {
        // Update active filter button
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Filter notifications
        const notifications = document.querySelectorAll('.notification-item');
        notifications.forEach(notification => {
            const notificationType = notification.getAttribute('data-type');
            if (type === 'all' || type === 'unread' && notification.classList.contains('unread') || type === notificationType) {
                notification.style.display = 'flex';
            } else {
                notification.style.display = 'none';
            }
        });
        
        // Show/hide empty state
        const visibleNotifications = Array.from(notifications).filter(n => n.style.display !== 'none');
        const emptyState = document.getElementById('emptyState');
        if (visibleNotifications.length === 0) {
            emptyState.style.display = 'block';
        } else {
            emptyState.style.display = 'none';
        }
    }

    function closeSettingsModal() {
        document.getElementById('settingsModal').style.display = 'none';
    }

    function saveSettings() {
        alert('Settings saved successfully!');
        closeSettingsModal();
    }

    // Load notifications from notification manager
    function loadNotifications() {
        if (!window.notificationManager) return;
        
        const notifications = window.notificationManager.getNotifications();
        const notificationsList = document.getElementById('notificationsList');
        
        if (notifications.length === 0) {
            document.getElementById('emptyState').style.display = 'block';
            return;
        }
        
        notificationsList.innerHTML = notifications.map(notification => `
            <div class="notification-item ${notification.unread ? 'unread' : 'read'}" data-type="${notification.type}" data-id="${notification.id}">
                <div class="notification-icon ${notification.type}">
                    <div class="icon-text">${getIconText(notification.type)}</div>
                </div>
                <div class="notification-content">
                    <div class="notification-header">
                        <h3>${notification.title}</h3>
                        <span class="notification-time">${notification.time}</span>
                    </div>
                    <p>${notification.message}</p>
                    <div class="notification-actions">
                        ${getActionButtons(notification)}
                        ${notification.unread ? '<button class="btn-link" onclick="markAsRead(this)">Mark as Read</button>' : ''}
                    </div>
                </div>
            </div>
        `).join('');
        
        updateFilterCounts();
    }

    function getIconText(type) {
        const icons = {
            'coaching': 'AI',
            'community': 'CM',
            'system': 'SY',
            'billing': 'BI'
        };
        return icons[type] || 'NO';
    }

    function getActionButtons(notification) {
        const actions = {
            'coaching': '<button class="btn-link" onclick="goToCoach()">View Insights</button>',
            'community': '<button class="btn-link" onclick="goToCommunity()">Join Conversation</button>',
            'system': '<button class="btn-link" onclick="goToDashboard()">View Report</button>',
            'billing': '<button class="btn-link" onclick="goToBilling()">View Receipt</button>'
        };
        return actions[notification.type] || '';
    }

    function updateFilterCounts() {
        if (!window.notificationManager) return;
        
        const notifications = window.notificationManager.getNotifications();
        const counts = {
            all: notifications.length,
            unread: notifications.filter(n => n.unread).length,
            coaching: notifications.filter(n => n.type === 'coaching').length,
            community: notifications.filter(n => n.type === 'community').length,
            system: notifications.filter(n => n.type === 'system').length,
            billing: notifications.filter(n => n.type === 'billing').length
        };
        
        Object.keys(counts).forEach(type => {
            const countElement = document.getElementById(`${type}Count`);
            if (countElement) {
                countElement.textContent = counts[type];
            }
        });
    }

    // Initialize notifications when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Wait a bit for notification manager to initialize
        setTimeout(() => {
            loadNotifications();
        }, 200);
    });
    </script>
</body>
</html>
